<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - B2B MarketPlace</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-store me-2"></i>TRADZY
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/products">
                            <i class="fas fa-boxes me-1"></i>Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/login">
                            <i class="fas fa-sign-in-alt me-1"></i>Login/Signup
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/contact">
                            <i class="fas fa-envelope me-1"></i>Contact
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="bg-light-custom" style="margin-top: 76px; padding: 3rem 0;">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h1 class="display-5 fw-bold text-primary">Product Catalog</h1>
                    <p class="lead text-muted-custom">Discover thousands of quality products from verified wholesalers</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters and Search -->
    <section class="py-4 bg-white border-bottom">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6 col-md-8">
                    <div class="input-group">
                        <input type="text" id="searchInput" class="form-control" placeholder="Search products..." aria-label="Search products">
                        <button class="btn btn-outline-secondary" type="button" onclick="searchProducts()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 mt-3 mt-md-0">
                    <select class="form-select" id="categoryFilter" onchange="filterProducts()">
                        <option value="">All Categories</option>
                        <option value="Fashion">Fashion & Apparel</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Home">Home & Kitchen</option>
                        <option value="Industrial">Industrial</option>
                        <option value="Sports">Sports & Fitness</option>
                        <option value="Beauty">Beauty & Personal Care</option>
                    </select>
                </div>
                <div class="col-lg-3 mt-3 mt-lg-0">
                    <select class="form-select" id="sortSelect" onchange="sortProducts()">
                        <option value="default">Default</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="name">Name: A to Z</option>
                        <option value="stock">Stock: High to Low</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Grid - DYNAMIC CONTENT LOADED FROM API -->
    <section class="section-padding">
        <div class="container">
            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading products...</span>
                </div>
                <p class="mt-3 text-muted">Loading products from database...</p>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="alert alert-danger d-none" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span id="errorText"></span>
            </div>

            <!-- Products Container - Populated Dynamically -->
            <div id="productsContainer" class="row">
                <!-- Products will be inserted here via JavaScript -->
            </div>

            <!-- No Products Message -->
            <div id="noProductsMessage" class="text-center py-5 d-none">
                <i class="fas fa-box-open fa-4x text-muted mb-3"></i>
                <h4>No Products Found</h4>
                <p class="text-muted">Try adjusting your search or filters</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-light py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5 class="mb-3"><i class="fas fa-store me-2"></i>TRADZY</h5>
                    <p class="text-muted">Your trusted B2B marketplace connecting retailers with verified wholesalers worldwide.</p>
                </div>
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h6 class="mb-3">Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="/" class="text-muted">Home</a></li>
                        <li><a href="/products" class="text-muted">Products</a></li>
                        <li><a href="/login" class="text-muted">Login</a></li>
                        <li><a href="/contact" class="text-muted">Contact</a></li>
                    </ul>
                </div>
                <div class="col-lg-4">
                    <h6 class="mb-3">Contact Us</h6>
                    <p class="text-muted"><i class="fas fa-envelope me-2"></i>info@tradzy.com</p>
                    <p class="text-muted"><i class="fas fa-phone me-2"></i>+1 234 567 8900</p>
                </div>
            </div>
            <hr class="my-4 bg-secondary">
            <div class="text-center text-muted">
                <p class="mb-0">&copy; 2025 TRADZY. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- API Integration Script -->
    <script src="/static/api.js"></script>
    
    <script>
        // =================================================================
        // DYNAMIC PRODUCT DATA LOADING
        // This script fetches real product data from the backend API
        // Data Flow: Database → Backend API (/api/products) → Frontend Display
        // =================================================================

        let allProducts = []; // Store all products from API
        let displayedProducts = []; // Store filtered/sorted products

        /**
         * Fetch products from backend API when page loads
         * API Endpoint: GET /api/products
         * Returns: JSON array of product objects from database
         */
        async function loadProducts() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const productsContainer = document.getElementById('productsContainer');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');

            try {
                // Show loading indicator
                loadingIndicator.classList.remove('d-none');
                productsContainer.innerHTML = '';
                errorMessage.classList.add('d-none');

                console.log('📡 Fetching products from API: /api/products');

                // Fetch products from backend API
                const response = await fetch('/api/products', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Parse JSON response from backend
                const products = await response.json();
                
                console.log(`✅ Loaded ${products.length} products from database`);

                // Store products globally
                allProducts = products;
                displayedProducts = [...products];

                // Hide loading indicator
                loadingIndicator.classList.add('d-none');

                // Render products on page
                renderProducts(displayedProducts);

            } catch (error) {
                console.error('❌ Error loading products:', error);
                
                // Hide loading, show error
                loadingIndicator.classList.add('d-none');
                errorMessage.classList.remove('d-none');
                errorText.textContent = 'Failed to load products. Please try again later.';
            }
        }

        /**
         * Render products to the DOM
         * @param {Array} products - Array of product objects from API
         */
        function renderProducts(products) {
            const productsContainer = document.getElementById('productsContainer');
            const noProductsMessage = document.getElementById('noProductsMessage');

            // Clear container
            productsContainer.innerHTML = '';

            // Show/hide no products message
            if (products.length === 0) {
                noProductsMessage.classList.remove('d-none');
                return;
            } else {
                noProductsMessage.classList.add('d-none');
            }

            // Create product cards dynamically
            products.forEach(product => {
                const productCard = createProductCard(product);
                productsContainer.appendChild(productCard);
            });
        }

        /**
         * Create a product card element
         * @param {Object} product - Product data from database
         * @returns {HTMLElement} Product card element
         */
        function createProductCard(product) {
            const col = document.createElement('div');
            col.className = 'col-lg-4 col-md-6 mb-4';

            // Get category color and icon
            const categoryInfo = getCategoryInfo(product.name);

            col.innerHTML = `
                <div class="product-card">
                    <div style="height: 250px; background: ${categoryInfo.gradient}; display: flex; align-items: center; justify-content: center;">
                        <div class="text-center">
                            <i class="${categoryInfo.icon}" style="font-size: 3rem; color: ${categoryInfo.color}; margin-bottom: 1rem;"></i>
                            <p style="color: ${categoryInfo.textColor}; margin: 0; font-weight: 600;">${categoryInfo.name}</p>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title">${escapeHtml(product.name)}</h5>
                            <span class="badge ${product.stock > 0 ? 'bg-success' : 'bg-danger'}">
                                ${product.stock > 0 ? 'In Stock' : 'Out of Stock'}
                            </span>
                        </div>
                        <p class="card-text">${escapeHtml(product.description)}</p>
                        <div class="product-price">₹${parseFloat(product.price).toFixed(2)}</div>
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">Stock: ${product.stock} units</small>
                            <div>
                                <button class="btn btn-outline-primary btn-sm me-2" onclick="addToWishlist(${product.id})">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button class="btn btn-custom-primary btn-sm" onclick="addToCart(${product.id})" ${product.stock <= 0 ? 'disabled' : ''}>
                                    <i class="fas fa-cart-plus me-1"></i>Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            return col;
        }

        /**
         * Get category styling based on product name/category
         * @param {string} productName - Name of the product
         * @returns {Object} Category styling information
         */
        function getCategoryInfo(productName) {
            const name = productName.toLowerCase();
            
            if (name.includes('shirt') || name.includes('fashion') || name.includes('apparel')) {
                return {
                    name: 'Fashion',
                    icon: 'fas fa-tshirt',
                    color: '#D97706',
                    textColor: '#92400E',
                    gradient: 'linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%)'
                };
            } else if (name.includes('phone') || name.includes('electronic') || name.includes('speaker') || name.includes('lamp')) {
                return {
                    name: 'Electronics',
                    icon: 'fas fa-mobile-alt',
                    color: '#2563EB',
                    textColor: '#1E40AF',
                    gradient: 'linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%)'
                };
            } else if (name.includes('kitchen') || name.includes('home') || name.includes('bed')) {
                return {
                    name: 'Home & Kitchen',
                    icon: 'fas fa-home',
                    color: '#059669',
                    textColor: '#065F46',
                    gradient: 'linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%)'
                };
            } else if (name.includes('safety') || name.includes('industrial')) {
                return {
                    name: 'Industrial',
                    icon: 'fas fa-hard-hat',
                    color: '#DC2626',
                    textColor: '#991B1B',
                    gradient: 'linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%)'
                };
            } else if (name.includes('yoga') || name.includes('fitness') || name.includes('sport')) {
                return {
                    name: 'Sports',
                    icon: 'fas fa-dumbbell',
                    color: '#7C3AED',
                    textColor: '#5B21B6',
                    gradient: 'linear-gradient(135deg, #EDE9FE 0%, #DDD6FE 100%)'
                };
            } else if (name.includes('hair') || name.includes('beauty')) {
                return {
                    name: 'Beauty',
                    icon: 'fas fa-spray-can',
                    color: '#EC4899',
                    textColor: '#BE185D',
                    gradient: 'linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%)'
                };
            }
            
            // Default category
            return {
                name: 'General',
                icon: 'fas fa-box',
                color: '#6B7280',
                textColor: '#374151',
                gradient: 'linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%)'
            };
        }

        /**
         * Escape HTML to prevent XSS attacks
         * @param {string} text - Text to escape
         * @returns {string} Escaped HTML
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /**
         * Search products by name or description
         */
        function searchProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            displayedProducts = allProducts.filter(product => {
                return product.name.toLowerCase().includes(searchTerm) ||
                       product.description.toLowerCase().includes(searchTerm);
            });

            renderProducts(displayedProducts);
        }

        /**
         * Filter products by category
         */
        function filterProducts() {
            const category = document.getElementById('categoryFilter').value.toLowerCase();
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            displayedProducts = allProducts.filter(product => {
                const matchesCategory = !category || 
                    product.name.toLowerCase().includes(category) ||
                    product.description.toLowerCase().includes(category);
                
                const matchesSearch = !searchTerm ||
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm);

                return matchesCategory && matchesSearch;
            });

            renderProducts(displayedProducts);
        }

        /**
         * Sort products by selected criteria
         */
        function sortProducts() {
            const sortBy = document.getElementById('sortSelect').value;

            switch (sortBy) {
                case 'price-low':
                    displayedProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    displayedProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'name':
                    displayedProducts.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'stock':
                    displayedProducts.sort((a, b) => b.stock - a.stock);
                    break;
                default:
                    // Reset to original order
                    displayedProducts = [...allProducts];
            }

            renderProducts(displayedProducts);
        }

        /**
         * Add product to wishlist (placeholder function)
         * @param {number} productId - ID of the product
         */
        function addToWishlist(productId) {
            console.log(`💖 Added product ${productId} to wishlist`);
            alert('Product added to wishlist! (Feature coming soon)');
        }

        /**
         * Add product to cart (placeholder function)
         * @param {number} productId - ID of the product
         */
        function addToCart(productId) {
            console.log(`🛒 Added product ${productId} to cart`);
            alert('Product added to cart! (Feature coming soon)');
        }

        // =================================================================
        // INITIALIZATION
        // Load products when page loads
        // =================================================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing products page...');
            loadProducts();
        });

        // Add search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });
    </script>

    <style>
        .product-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s ease;
            overflow: hidden;
            height: 100%;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #007bff;
            margin: 1rem 0;
        }

        .btn-custom-primary {
            background-color: #007bff;
            color: white;
            border: none;
        }

        .btn-custom-primary:hover {
            background-color: #0056b3;
            color: white;
        }

        .section-padding {
            padding: 3rem 0;
        }
    </style>
</body>
</html>
