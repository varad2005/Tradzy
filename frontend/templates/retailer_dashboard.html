<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Products - TRADZY</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --amazon-orange: #FF9900;
            --amazon-dark: #131921;
            --amazon-light: #232F3E;
            --amazon-blue: #146EB4;
            --bg-gray: #EAEDED;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-gray);
            font-family: 'Amazon Ember', Arial, sans-serif;
        }

        /* Amazon-style Header */
        .top-header {
            background-color: var(--amazon-dark);
            color: white;
            padding: 0.5rem 0;
        }

        .navbar {
            background-color: var(--amazon-light);
            padding: 0.75rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .navbar-brand {
            color: white !important;
            font-size: 1.5rem;
            font-weight: bold;
            border: 1px solid transparent;
            padding: 0.5rem 0.75rem;
            border-radius: 2px;
        }

        .navbar-brand:hover {
            border: 1px solid white;
        }

        .search-bar {
            flex: 1;
            max-width: 800px;
            margin: 0 1rem;
        }

        .search-bar input {
            border-radius: 4px 0 0 4px;
            border: none;
            padding: 0.6rem 1rem;
        }

        .search-bar button {
            background-color: var(--amazon-orange);
            border: none;
            border-radius: 0 4px 4px 0;
            padding: 0.6rem 1.25rem;
            color: var(--amazon-dark);
        }

        .search-bar button:hover {
            background-color: #F08804;
        }

        .nav-link {
            color: white !important;
            border: 1px solid transparent;
            padding: 0.5rem 0.75rem !important;
            border-radius: 2px;
            font-size: 0.95rem;
        }

        .nav-link:hover {
            border: 1px solid white;
        }

        .cart-badge {
            background-color: var(--amazon-orange);
            color: var(--amazon-dark);
            font-weight: bold;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.85rem;
            position: relative;
            top: -8px;
        }

        /* Main Content */
        .main-content {
            max-width: 1500px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Category Banner */
        .category-banner {
            background: white;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .category-banner h4 {
            margin: 0;
            color: var(--amazon-dark);
            font-size: 1.25rem;
        }

        /* Filters Sidebar */
        .filters-sidebar {
            background: white;
            padding: 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .filter-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #ddd;
        }

        .filter-section:last-child {
            border-bottom: none;
        }

        .filter-section h6 {
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--amazon-dark);
        }

        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        .filter-option input[type="checkbox"] {
            margin-right: 0.5rem;
            cursor: pointer;
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.25rem;
        }

        .product-card {
            background: white;
            border-radius: 4px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .product-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .product-image-container {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
            overflow: hidden;
        }

        .product-image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .product-image-container i {
            font-size: 4rem;
            color: #ccc;
        }

        .product-title {
            font-size: 0.95rem;
            color: var(--amazon-dark);
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.8rem;
        }

        .product-rating {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .stars {
            color: #FFA41C;
            margin-right: 0.5rem;
        }

        .rating-count {
            color: var(--amazon-blue);
            font-size: 0.85rem;
        }

        .product-price {
            font-size: 1.5rem;
            color: #B12704;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .product-price .currency {
            font-size: 0.75rem;
            vertical-align: super;
        }

        .stock-status {
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
        }

        .stock-status.in-stock {
            color: #007600;
        }

        .stock-status.low-stock {
            color: #B12704;
        }

        .stock-status.out-of-stock {
            color: #565959;
        }

        .seller-info {
            font-size: 0.8rem;
            color: #565959;
            margin-bottom: 0.75rem;
        }

        .product-actions {
            margin-top: auto;
        }

        .btn-add-cart {
            background-color: #FFD814;
            border: 1px solid #FCD200;
            border-radius: 20px;
            color: var(--amazon-dark);
            width: 100%;
            padding: 0.5rem 1rem;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn-add-cart:hover {
            background-color: #F7CA00;
            border-color: #F2C200;
            color: var(--amazon-dark);
        }

        .btn-buy-now {
            background-color: var(--amazon-orange);
            border: 1px solid #E77600;
            border-radius: 20px;
            color: var(--amazon-dark);
            width: 100%;
            padding: 0.5rem 1rem;
            font-weight: 500;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            transition: all 0.2s;
        }

        .btn-buy-now:hover {
            background-color: #F08804;
            border-color: #E67817;
            color: var(--amazon-dark);
        }

        .btn-wishlist {
            background: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            color: var(--amazon-dark);
            width: 100%;
            padding: 0.5rem 1rem;
            font-weight: 500;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            transition: all 0.2s;
        }

        .btn-wishlist:hover {
            background-color: #f8f9fa;
        }

        /* Loading Spinner */
        .loading-container {
            text-align: center;
            padding: 4rem 2rem;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            color: var(--amazon-orange);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .empty-state i {
            font-size: 4rem;
            color: #ccc;
            margin-bottom: 1rem;
        }

        /* Alert/Toast */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
        }

        .custom-toast {
            min-width: 300px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .custom-toast.success {
            border-left: 4px solid #007600;
        }

        .custom-toast.error {
            border-left: 4px solid #B12704;
        }

        /* Sort Dropdown */
        .sort-dropdown {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            margin-bottom: 1rem;
        }

        .results-count {
            color: #565959;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Top Header -->
    <div class="top-header">
        <div class="container-fluid px-4">
            <div class="d-flex justify-content-between align-items-center">
                <div class="text-white small">
                    <i class="fas fa-user-circle me-1"></i>
                    <span id="userGreeting">Hello, Retailer</span>
                </div>
                <div class="text-white small">
                    <i class="fas fa-phone me-1"></i> Customer Service: 1-800-TRADZY
                </div>
            </div>
        </div>
    </div>

    <!-- Main Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="/">
                <i class="fas fa-store me-2"></i>TRADZY
            </a>
            
            <!-- Search Bar -->
            <div class="search-bar d-flex">
                <input type="text" class="form-control" id="searchInput" placeholder="Search for products, brands, and more..." />
                <button class="btn" onclick="searchProducts()">
                    <i class="fas fa-search"></i>
                </button>
            </div>

            <div class="d-flex align-items-center">
                <a href="/retailer" class="nav-link">
                    <i class="fas fa-home me-1"></i> Dashboard
                </a>
                <a href="#" class="nav-link" onclick="viewOrders()">
                    <i class="fas fa-box me-1"></i> Orders
                </a>
                <a href="#" class="nav-link position-relative" onclick="viewCart()">
                    <i class="fas fa-shopping-cart fa-lg"></i>
                    <span class="cart-badge" id="cartCount">0</span>
                </a>
                <a href="#" class="nav-link" onclick="viewWishlist()">
                    <i class="fas fa-heart me-1"></i> Wishlist
                </a>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user me-1"></i> Account
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>My Profile</a></li>
                        <li><a class="dropdown-item" href="#" onclick="viewOrders()"><i class="fas fa-box me-2"></i>My Orders</a></li>
                        <li><a class="dropdown-item" href="#" onclick="viewWishlist()"><i class="fas fa-heart me-2"></i>My Wishlist</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Category Banner -->
        <div class="category-banner">
            <h4><i class="fas fa-boxes me-2"></i>Browse Products from Wholesalers</h4>
            <p class="mb-0 text-muted">Discover thousands of products at wholesale prices</p>
        </div>

        <div class="row">
            <!-- Filters Sidebar -->
            <div class="col-lg-3 col-md-4 mb-4">
                <div class="filters-sidebar">
                    <h5 class="mb-3"><i class="fas fa-filter me-2"></i>Filters</h5>
                    
                    <!-- Category Filter -->
                    <div class="filter-section">
                        <h6>Category</h6>
                        <div class="filter-option">
                            <input type="checkbox" id="cat-all" value="all" checked onchange="applyFilters()">
                            <label for="cat-all">All Categories</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="cat-electronics" value="electronics" onchange="applyFilters()">
                            <label for="cat-electronics">Electronics</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="cat-fashion" value="fashion & apparel" onchange="applyFilters()">
                            <label for="cat-fashion">Fashion & Apparel</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="cat-home" value="home & garden" onchange="applyFilters()">
                            <label for="cat-home">Home & Garden</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="cat-health" value="health & beauty" onchange="applyFilters()">
                            <label for="cat-health">Health & Beauty</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="cat-food" value="food & beverages" onchange="applyFilters()">
                            <label for="cat-food">Food & Beverages</label>
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="filter-section">
                        <h6>Price Range</h6>
                        <div class="filter-option">
                            <input type="checkbox" id="price-all" value="all" checked onchange="applyFilters()">
                            <label for="price-all">All Prices</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="price-1" value="0-50" onchange="applyFilters()">
                            <label for="price-1">Under ₹50</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="price-2" value="50-100" onchange="applyFilters()">
                            <label for="price-2">₹50 - ₹100</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="price-3" value="100-200" onchange="applyFilters()">
                            <label for="price-3">₹100 - ₹200</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="price-4" value="200-999999" onchange="applyFilters()">
                            <label for="price-4">₹200 & Above</label>
                        </div>
                    </div>

                    <!-- Stock Filter -->
                    <div class="filter-section">
                        <h6>Availability</h6>
                        <div class="filter-option">
                            <input type="checkbox" id="stock-available" value="available" checked onchange="applyFilters()">
                            <label for="stock-available">In Stock</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="stock-all" value="all" onchange="applyFilters()">
                            <label for="stock-all">Include Out of Stock</label>
                        </div>
                    </div>

                    <button class="btn btn-outline-secondary w-100 mt-3" onclick="clearFilters()">
                        <i class="fas fa-redo me-2"></i>Clear All Filters
                    </button>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="col-lg-9 col-md-8">
                <!-- Sort and Results -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="results-count" id="resultsCount">Loading products...</div>
                    <select class="sort-dropdown" id="sortSelect" onchange="sortProducts()">
                        <option value="featured">Featured</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="newest">Newest First</option>
                        <option value="name">Name: A to Z</option>
                    </select>
                </div>

                <!-- Products Container -->
                <div id="productsContainer">
                    <div class="loading-container">
                        <div class="spinner-border" role="status"></div>
                        <p class="mt-3">Loading products...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables
        let allProducts = [];
        let filteredProducts = [];
        let cartItems = [];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            loadProducts();
            loadCartCount();
            
            // Search on Enter key
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchProducts();
                }
            });
        });

        // Load user information
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/auth/check-auth');
                if (response.ok) {
                    const data = await response.json();
                    if (data.authenticated && data.user) {
                        document.getElementById('userGreeting').textContent = `Hello, ${data.user.username}`;
                    }
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        // Load all products
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                if (response.ok) {
                    allProducts = await response.json();
                    filteredProducts = [...allProducts];
                    applyFilters();
                } else {
                    showToast('Error loading products', 'error');
                    renderEmptyState();
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showToast('Error connecting to server', 'error');
                renderEmptyState();
            }
        }

        // Apply filters
        function applyFilters() {
            filteredProducts = [...allProducts];

            // Category filter
            const categoryCheckboxes = document.querySelectorAll('[id^="cat-"]:checked');
            const selectedCategories = Array.from(categoryCheckboxes).map(cb => cb.value);
            
            if (!selectedCategories.includes('all')) {
                filteredProducts = filteredProducts.filter(product => 
                    selectedCategories.some(cat => 
                        (product.category || '').toLowerCase().includes(cat.toLowerCase())
                    )
                );
            }

            // Price filter
            const priceCheckboxes = document.querySelectorAll('[id^="price-"]:checked');
            const selectedPriceRanges = Array.from(priceCheckboxes).map(cb => cb.value);
            
            if (!selectedPriceRanges.includes('all')) {
                filteredProducts = filteredProducts.filter(product => {
                    const price = parseFloat(product.price);
                    return selectedPriceRanges.some(range => {
                        const [min, max] = range.split('-').map(Number);
                        return price >= min && price <= max;
                    });
                });
            }

            // Stock filter
            const stockAvailable = document.getElementById('stock-available').checked;
            const stockAll = document.getElementById('stock-all').checked;
            
            if (stockAvailable && !stockAll) {
                filteredProducts = filteredProducts.filter(product => product.stock > 0);
            }

            // Search filter
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product =>
                    product.name.toLowerCase().includes(searchTerm) ||
                    (product.description || '').toLowerCase().includes(searchTerm) ||
                    (product.category || '').toLowerCase().includes(searchTerm)
                );
            }

            sortProducts();
        }

        // Sort products
        function sortProducts() {
            const sortValue = document.getElementById('sortSelect').value;

            switch(sortValue) {
                case 'price-low':
                    filteredProducts.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
                    break;
                case 'newest':
                    filteredProducts.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    break;
                case 'name':
                    filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                default: // featured
                    // Keep original order or sort by stock
                    filteredProducts.sort((a, b) => b.stock - a.stock);
            }

            renderProducts();
        }

        // Search products
        function searchProducts() {
            applyFilters();
        }

        // Clear all filters
        function clearFilters() {
            // Uncheck all category filters except "all"
            document.querySelectorAll('[id^="cat-"]').forEach(cb => cb.checked = false);
            document.getElementById('cat-all').checked = true;

            // Uncheck all price filters except "all"
            document.querySelectorAll('[id^="price-"]').forEach(cb => cb.checked = false);
            document.getElementById('price-all').checked = true;

            // Reset stock filters
            document.getElementById('stock-available').checked = true;
            document.getElementById('stock-all').checked = false;

            // Clear search
            document.getElementById('searchInput').value = '';

            // Reset sort
            document.getElementById('sortSelect').value = 'featured';

            applyFilters();
        }

        // Render products
        function renderProducts() {
            const container = document.getElementById('productsContainer');
            const resultsCount = document.getElementById('resultsCount');

            resultsCount.textContent = `${filteredProducts.length} results`;

            if (filteredProducts.length === 0) {
                renderEmptyState();
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'product-grid';

            filteredProducts.forEach(product => {
                const card = createProductCard(product);
                grid.appendChild(card);
            });

            container.innerHTML = '';
            container.appendChild(grid);
        }

        // Create product card
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';

            const price = parseFloat(product.price);
            const stock = parseInt(product.stock);
            const isInStock = stock > 0;
            const isLowStock = stock > 0 && stock <= 10;

            card.innerHTML = `
                <div class="product-image-container">
                    ${product.image_url 
                        ? `<img src="${product.image_url}" alt="${product.name}" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-box\\'></i>'">`
                        : '<i class="fas fa-box"></i>'}
                </div>
                <div class="product-title">${product.name}</div>
                <div class="product-rating">
                    <span class="stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="far fa-star"></i>
                    </span>
                    <span class="rating-count">(${Math.floor(Math.random() * 500) + 50})</span>
                </div>
                <div class="product-price">
                    <span class="currency">₹</span>${price.toFixed(2)}
                </div>
                <div class="stock-status ${isInStock ? (isLowStock ? 'low-stock' : 'in-stock') : 'out-of-stock'}">
                    ${isInStock 
                        ? (isLowStock ? `Only ${stock} left in stock` : 'In Stock')
                        : 'Currently Unavailable'}
                </div>
                <div class="seller-info">
                    <i class="fas fa-warehouse"></i> Sold by: ${product.owner_username || 'Wholesaler'}
                </div>
                ${product.description ? `<div class="seller-info" style="margin-top: 0.5rem;">${product.description.substring(0, 60)}${product.description.length > 60 ? '...' : ''}</div>` : ''}
                <div class="product-actions">
                    <button class="btn btn-add-cart" onclick="addToCart(${product.id}, '${product.name.replace(/'/g, "\\'")}', ${price})" ${!isInStock ? 'disabled' : ''}>
                        <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                    </button>
                    <button class="btn btn-buy-now" onclick="buyNow(${product.id})" ${!isInStock ? 'disabled' : ''}>
                        <i class="fas fa-bolt me-1"></i>Buy Now
                    </button>
                    <button class="btn btn-wishlist" onclick="addToWishlist(${product.id}, '${product.name.replace(/'/g, "\\'")}')">
                        <i class="far fa-heart me-1"></i>Add to Wishlist
                    </button>
                </div>
            `;

            return card;
        }

        // Render empty state
        function renderEmptyState() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h4>No products found</h4>
                    <p class="text-muted">Try adjusting your filters or search terms</p>
                    <button class="btn btn-primary mt-3" onclick="clearFilters()">
                        <i class="fas fa-redo me-2"></i>Clear Filters
                    </button>
                </div>
            `;
        }

        // Add to cart
        async function addToCart(productId, productName, price) {
            try {
                const response = await fetch('/api/cart/items', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        product_id: productId,
                        quantity: 1
                    })
                });

                if (response.ok) {
                    showToast(`"${productName}" added to cart!`, 'success');
                    loadCartCount();
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Error adding to cart', 'error');
                }
            } catch (error) {
                console.error('Error adding to cart:', error);
                showToast('Error connecting to server', 'error');
            }
        }

        // Buy now
        async function buyNow(productId) {
            // First add to cart
            try {
                const response = await fetch('/api/cart/items', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        product_id: productId,
                        quantity: 1
                    })
                });

                if (response.ok) {
                    // Redirect to cart/checkout
                    window.location.href = '/retailer/cart';
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Error processing order', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('Error connecting to server', 'error');
            }
        }

        // Add to wishlist
        async function addToWishlist(productId, productName) {
            try {
                const response = await fetch('/api/wishlist/items', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        product_id: productId
                    })
                });

                if (response.ok) {
                    showToast(`"${productName}" added to wishlist!`, 'success');
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Error adding to wishlist', 'error');
                }
            } catch (error) {
                console.error('Error adding to wishlist:', error);
                showToast('Error connecting to server', 'error');
            }
        }

        // Load cart count
        async function loadCartCount() {
            try {
                const response = await fetch('/api/cart');
                if (response.ok) {
                    const cart = await response.json();
                    const itemCount = cart.items ? cart.items.reduce((sum, item) => sum + item.quantity, 0) : 0;
                    document.getElementById('cartCount').textContent = itemCount;
                }
            } catch (error) {
                console.error('Error loading cart count:', error);
            }
        }

        // View cart
        function viewCart() {
            window.location.href = '/retailer/cart';
        }

        // View orders
        function viewOrders() {
            window.location.href = '/retailer/orders';
        }

        // View wishlist
        function viewWishlist() {
            window.location.href = '/retailer/wishlist';
        }

        // Logout
        async function logout() {
            if (!confirm('Are you sure you want to logout?')) return;

            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST'
                });

                if (response.ok) {
                    window.location.href = '/login';
                } else {
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/login';
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `custom-toast ${type}`;
            
            const icon = type === 'success' 
                ? '<i class="fas fa-check-circle me-2" style="color: #007600;"></i>'
                : '<i class="fas fa-exclamation-circle me-2" style="color: #B12704;"></i>';

            toast.innerHTML = `
                ${icon}
                <span>${message}</span>
            `;

            container.appendChild(toast);

            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>